# srcset Gallery Image Debugging Notes

## Issue Summary

The gallery images in the Work post type are not displaying `srcset` attributes, despite other images on the site (including featured images and related projects) working correctly with responsive images.

## Critical Thinking Insights

1. **Standard WordPress Functions vs. Manual Implementation**
   - Images using `the_post_thumbnail()` and `wp_get_attachment_image()` have proper `srcset` attributes
   - The gallery function `work_display_gallery()` uses manual HTML construction with `wp_get_attachment_image_src()`
   - Manual HTML construction bypasses WordPress's automatic `srcset` generation

2. **What's Working vs. What's Not**
   - Related project images work (using `the_post_thumbnail()`)
   - Featured images work (using `the_post_thumbnail()` or `wp_get_attachment_image()`)
   - Only the gallery images (in Swiper slider) are missing `srcset`

3. **WebP Conversion Is Not the Core Issue**
   - WebP conversion was a red herring - the issue persists even after:
     - Simplifying the WebP functions
     - Removing gallery-specific exclusions 
     - Reverting complex code additions

4. **Simple vs. Complex Solutions**
   - Initial debugging focused on complex WebP conversion issues
   - Reverting to standard code didn't break anything, suggesting overengineering
   - 16+ hours spent on complex solutions while the root cause was simpler

5. **Data Flow Observations**
   - The `srcset` is being generated by WordPress but not included in the final HTML
   - Simple HTML changes have more impact than filter manipulations

## Attempted Solutions

1. **Replace Manual Image Tag Construction** *(Did not work)*
   ```php
   // Changed from:
   $full_image = wp_get_attachment_image_src($image_id, 'full');
   // ...
   <img class="lazy-imgs" src="<?php echo esc_url($full_image[0]); ?>" alt="<?php echo esc_attr($alt_text); ?>" loading="lazy">
   
   // To:
   $image_attributes = array(
       'class' => 'lazy-imgs',
       'loading' => 'lazy',
       'alt' => $alt_text
   );
   // ...
   <?php echo wp_get_attachment_image($image_id, 'full', false, $image_attributes); ?>
   ```

2. **Modify WebP Filters**
   - Simplified `kaneism_should_exclude_webp()` function
   - Removed gallery-specific function checks
   - Removed custom class checks

3. **Revert Template Modifications**
   - Restored the Related Projects section to original HTML structure
   - Reverted to using `the_post_thumbnail()` instead of `wp_get_attachment_image()`

4. **Swiper Integration Testing** *(Definitely not the issue)*
   - Completely disabled Swiper JavaScript by:
     - Commenting out `add_action('wp_enqueue_scripts', 'work_enqueue_scripts');`
     - Commenting out all script file paths in both the main enqueue function and inside the gallery function
   - Refreshed the page and confirmed srcset attributes still didn't appear
   - Conclusively eliminated Swiper as a possible cause

## Current State

1. The issue persists despite multiple approaches
2. All files have been reverted to a cleaner state
3. We know exactly where in the code the issue exists (`work_display_gallery()` function)
4. The Related Projects are working correctly with `srcset`

## Next Approaches to Consider

1. **Image Metadata**
   - Check if gallery images have proper metadata for srcset generation
   - Test with a known working image in the gallery

2. **Add Debug Output**
   - Add test code to display both direct image HTML and filtered HTML side by side

3. **Filter Investigation**
   - Check if any filters are interfering with srcset specifically for gallery images
   - Add temporary hooks to inspect filter chain

4. **Minimal Test Case**
   - Create a minimal gallery implementation with just one image
   - Compare direct output of wp_get_attachment_image vs. current approach

## Lessons Learned

1. "The simplest solution is always the best" - complex solutions often introduce more problems
2. Reverting to standard WordPress functions is often the right approach
3. WebP conversion was not causing the issue - it was a standard HTML generation problem
4. Sometimes stepping back and looking at the basics is more valuable than deep technical solutions 

---
*Created as a reference after 16+ hours of debugging and troubleshooting on the Work plugin's gallery image display.* 