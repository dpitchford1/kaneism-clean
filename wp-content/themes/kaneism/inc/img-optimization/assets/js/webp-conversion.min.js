jQuery(document).ready((function($){var processingTimeout,progressUpdateInterval,isProcessing=!1,isPaused=!1,consecutiveErrors=0,maxConsecutiveErrors=5,progressData={processed:parseInt($(".progress-text").data("processed")||0),total:parseInt($(".progress-text").data("total")||0),failedImages:[]};function pauseProcessing(){isPaused=!0,isProcessing=!1,clearTimeout(processingTimeout),clearInterval(progressUpdateInterval),showButton("resume-processing"),addLogEntry("‚è∏Ô∏è Conversion process paused","paused")}function processNextImage(){isProcessing&&!isPaused&&$.ajax({url:kaneismWebp.ajaxUrl,type:"POST",data:{action:"kaneism_webp_process_single",nonce:kaneismWebp.nonce},dataType:"json",success:function(response){consecutiveErrors=0,response.success?function(response){if(!response.data)return;var data=response.data;data.progress&&updateProgressDisplay(data.progress);data.image&&data.image.name&&$("#current-image-name").text(data.image.name);if(data.image){var image=data.image,logMessage="",logType="";if(image.success){if(logMessage="‚úÖ Converted: "+image.name,image.original_size&&image.webp_size)logMessage+=" ("+formatBytes(image.original_size)+" ‚Üí "+formatBytes(image.webp_size)+", "+Math.round(100*(1-image.webp_size/image.original_size))+"% smaller)";logType="success"}else logMessage="‚ùå Failed: "+image.name+" - "+(image.error||"Unknown error"),logType="error",progressData.failedImages.push(image.name);addLogEntry(logMessage,logType)}data.messages&&data.messages.length&&data.messages.forEach((function(msg){addLogEntry(msg.text,msg.type||"info")}))}(response):function(response){var errorMessage=response.data&&response.data.message?response.data.message:"Unknown error occurred during conversion";addLogEntry("‚ö†Ô∏è "+errorMessage,"error"),++consecutiveErrors>=maxConsecutiveErrors&&(addLogEntry("üõë Too many consecutive errors. Process paused. Please check the logs and try again.","warning"),pauseProcessing())}(response),response.data&&response.data.converting?processingTimeout=setTimeout(processNextImage,250):function(){isProcessing=!1,clearInterval(progressUpdateInterval),showButton("start-processing"),$("#current-processing").hide(),progressData.failedImages.length>0?addLogEntry("üèÅ Conversion process completed with "+progressData.failedImages.length+" failed images","warning"):addLogEntry("üéâ Conversion process completed successfully! All images have been converted.","success");setTimeout((function(){window.location.reload()}),2e3)}()},error:function(xhr,status,error){!function(xhr,status,error){addLogEntry("üõë AJAX Error: "+(error||status),"error"),++consecutiveErrors>=maxConsecutiveErrors?(addLogEntry("üõë Too many consecutive errors. Process paused. Please refresh the page and try again.","warning"),pauseProcessing()):processingTimeout=setTimeout(processNextImage,3e3)}(0,status,error)}})}function startProgressUpdateInterval(){progressUpdateInterval=setInterval((function(){$.ajax({url:kaneismWebp.ajaxUrl,type:"POST",data:{action:"kaneism_webp_get_progress",nonce:kaneismWebp.nonce},dataType:"json",success:function(response){response.success&&response.data&&updateProgressDisplay(response.data)}})}),5e3)}function updateProgressDisplay(progress){if(progress){var percent=progress.total_images>0?progress.processed_images/progress.total_images*100:0;$(".progress").css("width",percent+"%"),$(".progress-text").html("<strong>Progress:</strong> "+progress.processed_images+" of "+progress.total_images+" images processed ("+Math.round(10*percent)/10+"%)"),progressData.processed=progress.processed_images,progressData.total=progress.total_images,void 0!==progress.space_saved&&$(".stats-section").length}}function addLogEntry(message,type){if(message){type=type||"info";var now=new Date,timeStr=now.getHours().toString().padStart(2,"0")+":"+now.getMinutes().toString().padStart(2,"0")+":"+now.getSeconds().toString().padStart(2,"0"),logEntry=$('<li class="log-entry log-'+type+'"></li>');logEntry.html('<span class="log-time">['+timeStr+"]</span> "+message),$("#log-entries").prepend(logEntry),$("#processing-log").scrollTop(0)}}function showButton(buttonId){["start-processing","pause-processing","resume-processing"].forEach((function(id){id===buttonId?$("#"+id).show():$("#"+id).hide()}))}function formatBytes(bytes,decimals){if(0===bytes)return"0 Bytes";decimals=decimals||2;var i=Math.floor(Math.log(bytes)/Math.log(1024));return parseFloat((bytes/Math.pow(1024,i)).toFixed(decimals))+" "+["Bytes","KB","MB","GB"][i]}$(".progress-bar").length&&showButton("start-processing"),$("#start-processing").on("click",(function(){!function(){if(isProcessing)return;isProcessing=!0,isPaused=!1,consecutiveErrors=0,showButton("pause-processing"),$("#current-processing").show(),addLogEntry("‚ö°Ô∏è Starting WebP conversion process","info"),startProgressUpdateInterval(),processNextImage()}()})),$("#pause-processing").on("click",(function(){pauseProcessing()})),$("#resume-processing").on("click",(function(){!function(){if(isProcessing)return;isProcessing=!0,isPaused=!1,consecutiveErrors=0,showButton("pause-processing"),addLogEntry("‚ñ∂Ô∏è Resuming conversion process","info"),startProgressUpdateInterval(),processNextImage()}()}))}));