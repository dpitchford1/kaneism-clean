var kaneshop=kaneshop||{};window.kaneshop=function(window,document,kaneshopwrapper){"use strict";const doc=document,exitcanvashtml=doc.querySelector("#site-body"),exitcanvasbody=doc.querySelector("#page-body"),exitcanvas=doc.querySelector("#exit-off-canvas"),headerSS=doc.querySelector("#global-header--ss"),header=doc.querySelector("#global-header"),searchform=doc.querySelector("#searchform"),fragment=doc.createDocumentFragment(),toggler=fragment.appendChild(doc.createElement("a")),ssLogo=fragment.appendChild(doc.createElement("a")),searchtoggle=fragment.appendChild(doc.createElement("a")),mediaQuery=window.matchMedia("(max-width: 767px)"),supportsTouch="ontouchstart"in window||navigator.maxTouchPoints>0,supportsPassiveEvents=function(){let passiveSupported=!1;try{const options={get passive(){return passiveSupported=!0,!0}};window.addEventListener("test",null,options),window.removeEventListener("test",null,options)}catch(e){passiveSupported=!1}return passiveSupported}();function addEventListenerWithOptions(element,eventType,handler,options={}){if(elementExists(element))try{supportsTouch&&"click"===eventType&&element.addEventListener("touchend",(function(e){e.preventDefault(),e.stopPropagation(),handler(e)}),!!supportsPassiveEvents&&{passive:!1,...options}),element.addEventListener(eventType,handler,!!supportsPassiveEvents&&options)}catch(e){console.error(`Error adding event listener for ${eventType}:`,e),element.addEventListener(eventType,handler)}}let scrollpos=window.scrollY,ticking=!1;function elementExists(element){return null!=element}function throttle(callback,delay){let lastCall=0;return function(...args){const now=(new Date).getTime();if(!(now-lastCall<delay))return lastCall=now,callback(...args)}}function setAttributes(el,attrs){if(elementExists(el))if(attrs&&"object"==typeof attrs)try{Object.keys(attrs).forEach((key=>{void 0!==attrs[key]&&null!==attrs[key]&&el.setAttribute(key,attrs[key])}))}catch(e){console.error("Error setting attributes:",e)}else console.warn("Invalid attributes object");else console.warn("Cannot set attributes on non-existent element")}function init(){elementExists(headerSS)?(headerSS.appendChild(fragment),toggler.innerHTML="Menu",ssLogo.innerHTML="Kaneism",searchtoggle.innerHTML="Search",setAttributes(toggler,{"aria-controls":"global-header",href:"#global-header",id:"menu-trigger",role:"button",class:"menu-trigger ico i--menu","aria-expanded":"false","aria-label":"Toggle menu"}),setAttributes(ssLogo,{class:"brand brand-ss",href:"/",id:"menu-ss"}),setAttributes(searchtoggle,{"aria-controls":"searchform",href:"#searchform",id:"search-trigger",role:"button",class:"search-trigger ico i--search","aria-expanded":"false","aria-label":"Toggle search"})):console.warn("Small screen header element not found, skipping setup"),function(){if(elementExists(header))if("IntersectionObserver"in window){const sentinel=document.createElement("div");sentinel.classList.add("sticky-sentinel"),sentinel.style.position="absolute",sentinel.style.top="0",sentinel.style.height="50px",sentinel.style.width="1px",sentinel.style.opacity="0",sentinel.style.pointerEvents="none",header.parentNode&&header.parentNode.insertBefore(sentinel,header),new IntersectionObserver((entries=>{entries.forEach((entry=>{entry.isIntersecting?remove_class_on_scroll():add_class_on_scroll()}))}),{threshold:0,rootMargin:"-50px 0px 0px 0px"}).observe(sentinel)}else{function onScroll(){scrollpos=window.scrollY,ticking||(window.requestAnimationFrame((()=>{scrollpos>50?add_class_on_scroll():remove_class_on_scroll(),ticking=!1})),ticking=!0)}window.addEventListener("scroll",throttle(onScroll,100),!!supportsPassiveEvents&&{passive:!0})}else console.warn("Header element not found, skipping sticky header functionality");function add_class_on_scroll(){header.classList.add("is--sticky")}function remove_class_on_scroll(){header.classList.remove("is--sticky")}}(),function(){if(!(elementExists(toggler)&&elementExists(searchtoggle)&&elementExists(exitcanvas)&&elementExists(header)&&elementExists(searchform)))return void console.warn("Required menu elements not found, skipping menu functionality");let lastFocusedElement=null;function restoreFocus(){lastFocusedElement&&"function"==typeof lastFocusedElement.focus&&setTimeout((()=>{lastFocusedElement.focus()}),100)}function createFocusTrap(container){if(!elementExists(container))return;const focusableElements=Array.from(container.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'));if(0===focusableElements.length)return;const firstElement=focusableElements[0],lastElement=focusableElements[focusableElements.length-1];container.addEventListener("keydown",(function(e){"Tab"===e.key&&(e.shiftKey&&document.activeElement===firstElement?(e.preventDefault(),lastElement.focus()):e.shiftKey||document.activeElement!==lastElement||(e.preventDefault(),firstElement.focus()))}))}setTimeout((function(){createFocusTrap(header),createFocusTrap(searchform)}),500);const UIState={menuVisible:!1,searchVisible:!1,toggleMenu:function(){return this.searchVisible&&this.closeSearch(),this.menuVisible=!this.menuVisible,this.updateUI(),this.menuVisible?lastFocusedElement=document.activeElement:restoreFocus(),this.menuVisible},toggleSearch:function(){return this.menuVisible&&this.closeMenu(),this.searchVisible=!this.searchVisible,this.updateUI(),this.searchVisible?lastFocusedElement=document.activeElement:restoreFocus(),this.searchVisible},closeAll:function(){const wasOpen=this.menuVisible||this.searchVisible;this.menuVisible=!1,this.searchVisible=!1,this.updateUI(),wasOpen&&restoreFocus()},closeMenu:function(){const wasOpen=this.menuVisible;this.menuVisible=!1,this.updateUI(),wasOpen&&restoreFocus()},closeSearch:function(){const wasOpen=this.searchVisible;this.searchVisible=!1,this.updateUI(),wasOpen&&restoreFocus()},updateUI:function(){try{setAttributes(header,{"data-nav-slide":this.menuVisible?"slide visible":"slide hidden","aria-hidden":this.menuVisible?"false":"true"}),toggler.className=this.menuVisible?"menu-trigger open ico i--close":"menu-trigger ico i--menu",setAttributes(toggler,{"aria-expanded":this.menuVisible?"true":"false"}),setAttributes(searchform,{"data-search-slide":this.searchVisible?"slide visible":"slide hidden","aria-hidden":this.searchVisible?"false":"true"}),searchtoggle.className=this.searchVisible?"search-trigger open ico i--close":"search-trigger ico i--search",setAttributes(searchtoggle,{"aria-expanded":this.searchVisible?"true":"false"}),setAttributes(exitcanvasbody,{"data-off-screen":this.menuVisible?"visible":"hidden"}),setAttributes(exitcanvashtml,{"data-off-canvas":this.searchVisible?"visible":"hidden"});const mainContent=doc.querySelector("#main");elementExists(mainContent)&&(this.menuVisible||this.searchVisible?(mainContent.setAttribute("tabindex","-1"),mainContent.setAttribute("aria-hidden","true")):(mainContent.removeAttribute("tabindex"),mainContent.removeAttribute("aria-hidden")))}catch(e){console.error("Error updating UI:",e)}},init:function(){try{this.menuVisible="slide visible"===header.getAttribute("data-nav-slide"),this.searchVisible="slide visible"===searchform.getAttribute("data-search-slide"),setAttributes(exitcanvashtml,{"data-off-canvas":"hidden"}),setAttributes(exitcanvasbody,{"data-off-screen":"hidden"}),setAttributes(toggler,{"aria-expanded":this.menuVisible?"true":"false"}),setAttributes(searchtoggle,{"aria-expanded":this.searchVisible?"true":"false"}),setAttributes(header,{"aria-hidden":this.menuVisible?"false":"true"}),setAttributes(searchform,{"aria-hidden":this.searchVisible?"false":"true"})}catch(e){console.error("Error initializing UI state:",e),this.menuVisible=!1,this.searchVisible=!1}}};function headerHide(mq){UIState.menuVisible=!mq.matches,UIState.searchVisible=!1,UIState.updateUI(),setAttributes(exitcanvashtml,{"data-off-canvas":"hidden"}),setAttributes(exitcanvasbody,{"data-off-screen":"hidden"}),mq.matches?(setAttributes(header,{"aria-labelledby":"menu-trigger",role:"navigation"}),setAttributes(searchform,{"aria-labelledby":"search-trigger",role:"search"})):(setAttributes(header,{"aria-labelledby":null,role:"navigation"}),setAttributes(searchform,{"aria-labelledby":null,role:"search"}))}UIState.init(),addEventListenerWithOptions(toggler,"click",(function(e){e.preventDefault(),UIState.toggleMenu()})),addEventListenerWithOptions(searchtoggle,"click",(function(e){e.preventDefault(),UIState.toggleSearch()})),addEventListenerWithOptions(exitcanvas,"click",(function(e){e.preventDefault(),UIState.closeAll()})),document.addEventListener("keydown",(function(e){if("Escape"!==e.key){if("m"===e.key&&e.altKey)return e.preventDefault(),void UIState.toggleMenu();if("s"===e.key&&e.altKey)return e.preventDefault(),void UIState.toggleSearch();if(UIState.menuVisible){const menuLinks=header.querySelectorAll("a[href], button");if(0===menuLinks.length)return;let currentIndex=Array.from(menuLinks).indexOf(document.activeElement);if(-1===currentIndex)return;"ArrowDown"===e.key?(e.preventDefault(),menuLinks[(currentIndex+1)%menuLinks.length].focus()):"ArrowUp"===e.key&&(e.preventDefault(),menuLinks[(currentIndex-1+menuLinks.length)%menuLinks.length].focus())}}else UIState.closeAll()})),mediaQuery.addEventListener("change",headerHide),headerHide(mediaQuery)}(),function(){const checkbox=doc.querySelector(".theme-checkbox");if(!elementExists(checkbox))return void console.warn("Theme switcher checkbox not found, skipping theme switching functionality");function setLocalStorageItem(key,value){try{return localStorage.setItem(key,value),!0}catch(e){return console.warn("Unable to save to localStorage:",e),!1}}if(doc.documentElement.classList.add("light"),checkbox.addEventListener("change",(function(e){e.target.checked?(doc.body.setAttribute("data-theme","dark"),doc.documentElement.classList.add("dark"),doc.documentElement.classList.remove("light"),setLocalStorageItem("theme","dark")):(doc.body.setAttribute("data-theme","light"),doc.documentElement.classList.remove("dark"),doc.documentElement.classList.add("light"),setLocalStorageItem("theme","light"))})),supportsTouch){const checkboxLabel=doc.querySelector(".theme-checkbox-label");elementExists(checkboxLabel)&&addEventListenerWithOptions(checkboxLabel,"click",(function(e){e.stopPropagation()}))}const currentTheme=function(key){try{return localStorage.getItem(key)}catch(e){return console.warn("Unable to access localStorage:",e),null}}("theme");currentTheme&&(doc.body.setAttribute("data-theme",currentTheme),"dark"===currentTheme?(checkbox.checked=!0,doc.documentElement.classList.add("dark"),doc.documentElement.classList.remove("light")):(doc.documentElement.classList.add("light"),doc.documentElement.classList.remove("dark")))}(),function(){const toTopButton=doc.querySelector(".js-BackToTop");elementExists(toTopButton)?addEventListenerWithOptions(toTopButton,"click",(function(e){e.preventDefault();try{if("scrollBehavior"in document.documentElement.style)window.scrollTo({top:0,behavior:"smooth"});else{function _scrollToTop(){0===doc.body.scrollTop&&0===doc.documentElement.scrollTop||(window.scrollBy(0,-50),setTimeout(_scrollToTop,10))}_scrollToTop()}}catch(e){console.error("Error during scroll to top:",e),window.scrollTo(0,0)}})):console.warn("Back to top button not found, skipping functionality")}()}return"complete"===document.readyState||"interactive"===document.readyState?setTimeout(init,1):document.addEventListener("DOMContentLoaded",init),{elementExists:elementExists,setAttributes:setAttributes,throttle:throttle,debounce:function(callback,wait){let timeout;return function(...args){const context=this;clearTimeout(timeout),timeout=setTimeout((()=>callback.apply(context,args)),wait)}},addEventListenerWithOptions:addEventListenerWithOptions}}(window,document);