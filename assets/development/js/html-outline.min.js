document.addEventListener("DOMContentLoaded",(function(){const debug=!1;function log(msg){debug&&console.log("HTML Outline: "+msg)}log("Initializing...");const triggerButton=document.getElementById("html-outline-trigger"),outlineContainer=document.getElementById("html-outline-container"),outlineClose=document.getElementById("html-outline-close"),outlineResult=document.getElementById("html-outline-result");function escapeHtml(text){const div=document.createElement("div");return div.textContent=text,div.innerHTML}triggerButton&&outlineContainer&&outlineResult&&(triggerButton.addEventListener("click",(function(e){log("Button clicked"),e.preventDefault(),e.stopPropagation(),outlineContainer.classList.contains("active")?outlineContainer.classList.remove("active"):(outlineContainer.classList.add("active"),log("Generating outline..."),outlineResult.innerHTML='<div class="loading">Analyzing page structure...</div>',setTimeout((function(){try{log("Analyzing document...");const outline=function(){const outline={sections:[],headings:[],issues:[]},sectioningElements=document.querySelectorAll("article, aside, nav, section, main, header, footer");outline.sections=Array.from(sectioningElements).map((elem=>({tagName:elem.tagName.toLowerCase(),id:elem.id||null,className:elem.className||null,headings:Array.from(elem.querySelectorAll("h1, h2, h3, h4, h5, h6")).map((h=>({level:parseInt(h.tagName[1]),text:h.textContent.trim(),element:h})))})));const allHeadings=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let previousLevel=0;return outline.headings=Array.from(allHeadings).map((h=>{const level=parseInt(h.tagName[1]),heading={level:level,text:h.textContent.trim(),element:h,hasSkippedLevel:level>previousLevel+1};return heading.hasSkippedLevel&&outline.issues.push({type:"skipped_level",message:`Heading level skipped from H${previousLevel} to H${level}`,element:h}),previousLevel=level,heading})),0===document.querySelectorAll("h1").length&&outline.issues.push({type:"no_h1",message:"Page does not contain an H1 heading",element:document.body}),document.querySelectorAll("h1").length>1&&outline.issues.push({type:"multiple_h1",message:"Page contains multiple H1 headings",element:document.querySelectorAll("h1")}),outline}();log("Analysis complete, rendering results"),function(outline){let html="";outline.issues.length>0&&(html+='<div class="outline-issues">',html+="<h3>Potential Issues</h3>",html+='<ul class="issues-list">',outline.issues.forEach((issue=>{html+=`<li class="issue-item"><span class="issue-type">${issue.type}</span>: ${issue.message}</li>`})),html+="</ul>",html+="</div>"),html+='<div class="outline-hierarchy">',html+="<h3>Heading Hierarchy</h3>",html+='<ul class="heading-list">',outline.headings.forEach((heading=>{let className=heading.hasSkippedLevel?"heading-item error":"heading-item";html+=`<li class="${className}" style="margin-left: ${1.25*(heading.level-1)}rem">\n                <span class="heading-level">H${heading.level}</span>\n                <span class="heading-text">${escapeHtml(heading.text)}</span>\n            </li>`})),html+="</ul>",html+="</div>",html+='<div class="outline-sections">',html+="<h3>Document Sections</h3>",0===outline.sections.length?html+="<p>No HTML5 sectioning elements found</p>":(html+='<ul class="section-list">',outline.sections.forEach((section=>{html+=`<li class="section-item">\n                    <span class="section-tag">&lt;${section.tagName}&gt;</span>\n                    ${section.id?`<span class="section-id">#${section.id}</span>`:""}\n                    ${section.className?`<span class="section-class">.${section.className.replace(/\s+/g,".")}</span>`:""}\n                    \n                    ${section.headings.length>0?`<ul class="section-headings">\n                            ${section.headings.map((h=>`<li>H${h.level}: ${escapeHtml(h.text)}</li>`)).join("")}\n                        </ul>`:'<p class="warning">No headings in this section</p>'}\n                </li>`})),html+="</ul>"),html+="</div>",html+='<div class="outline-recommendations">',html+="<h3>Recommendations</h3>",html+="<ul>",html+="<li>Each page should have exactly one H1 heading</li>",html+="<li>Heading levels should not skip (e.g., from H2 to H4)</li>",html+="<li>Each section should contain at least one heading</li>",html+="<li>Headings should describe the content that follows them</li>",html+="</ul>",html+="</div>",html+='<div class="outline-shortcuts">',html+="<h3>Keyboard Shortcuts</h3>",html+="<ul>",html+="<li><kbd>Esc</kbd> - Close HTML outline panel</li>",html+="</ul>",html+="</div>",outlineResult.innerHTML=html}(outline)}catch(error){log("ERROR: "+error.message),outlineResult.innerHTML=`<div class="error">Error analyzing outline: ${error.message}</div>`,console.error("HTML Outline Error:",error)}}),10))})),outlineClose&&outlineClose.addEventListener("click",(function(e){log("Close button clicked"),e.preventDefault(),outlineContainer.classList.remove("active")})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&outlineContainer.classList.contains("active")&&(log("ESC pressed, closing panel"),outlineContainer.classList.remove("active"))})),log("Setup complete"))}));